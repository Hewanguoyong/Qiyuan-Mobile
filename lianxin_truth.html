<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>资产清单 | 莲心会</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- 全局设置 --- */
        :root {
            --text-green: #00ff41;
            --text-red: #ff3333;
            --bg-overlay: rgba(0, 0, 0, 0.9);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Roboto Mono', "SimSun", monospace;
            color: var(--text-green);
            line-height: 1.6;
            min-height: 100vh;
            background-image: url('莲心会5.jpg'); 
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #000;
            cursor: crosshair;
            overflow-x: hidden;
        }

        /* 遮罩层 */
        .overlay-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: -1; pointer-events: none;
        }

        /* --- 正常页面元素 --- */
        .page-number {
            position: fixed; bottom: 20px; right: 30px;
            color: var(--text-green); font-size: 14px; letter-spacing: 2px;
            z-index: 100; pointer-events: none; opacity: 0.8;
            text-shadow: 0 0 5px rgba(0, 255, 65, 0.3);
        }

        .navbar {
            width: 100%; padding: 15px 50px; display: flex; justify-content: center;
            background: rgba(0, 0, 0, 0.95); border-bottom: 2px solid var(--text-red);
            position: fixed; top: 0; z-index: 100; pointer-events: none;
        }

        .nav-links span {
            color: var(--text-red); margin: 0 25px; font-size: 1.1rem;
            letter-spacing: 1px; font-weight: bold; text-transform: uppercase;
        }

        .container {
            max-width: 1000px; margin-top: 100px; margin-bottom: 80px; padding: 40px;
            background-color: var(--bg-overlay); border: 1px solid var(--text-red);
            box-shadow: 0 0 20px rgba(255, 51, 51, 0.2); text-align: left;
            width: 90%; /* 适配手机宽度 */
        }

        h1 {
            font-size: 2rem; margin-bottom: 40px; color: var(--text-red);
            border-bottom: 1px dashed var(--text-red); padding-bottom: 10px;
            text-transform: uppercase; letter-spacing: 2px; text-align: center;
        }

        /* --- 资产卡片 --- */
        .asset-card { display: flex; gap: 20px; margin-bottom: 40px; padding-bottom: 30px; border-bottom: 1px dotted var(--text-green); }
        .asset-card:last-child { border-bottom: none; }
        .asset-img-box { flex: 0 0 200px; height: 260px; border: 1px solid var(--text-green); position: relative; }
        .asset-img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%) contrast(1.2) brightness(0.8); mix-blend-mode: luminosity; }
        .asset-img-box::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 255, 65, 0.1); pointer-events: none; }
        .asset-info { flex: 1; font-size: 0.95rem; }
        .data-row { margin-bottom: 8px; }
        .label { color: var(--text-red); font-weight: bold; margin-right: 10px; }
        .value { color: var(--text-green); word-break: break-all; /* 防止长文本撑破 */ }

        /* --- 弹窗样式 --- */
        .modal {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(0,0,0,0.8);
            justify-content: center; align-items: center;
        }
        
        .modal-content {
            background-color: #000; padding: 60px; border: 4px solid var(--text-red);
            text-align: center; box-shadow: 0 0 50px var(--text-red);
            max-width: 600px; width: 90%; position: relative;
        }
        .modal-text {
            font-size: 2rem; color: #fff; letter-spacing: 2px;
            font-family: "SimSun", serif; margin-bottom: 30px;
        }

        .forever { color: var(--text-red); font-weight: bold; font-size: 2.5rem; }
        
        .close-btn {
            background: transparent; border: 1px solid var(--text-red); color: var(--text-red);
            padding: 10px 30px; font-family: 'Roboto Mono', monospace; font-size: 1rem;
            cursor: pointer; transition: all 0.3s;
        }
        .close-btn:hover { background: var(--text-red); color: #000; }

        /* =========================================
            以下为“花屏/诡异模式”样式
            ========================================= */

        #glitch-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 9999; background: #000; overflow: hidden;
            justify-content: center; align-items: center;
        }
        .glitch-active body { overflow: hidden; }

        /* 背景扫描线 */
        .noise-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(
                0deg, rgba(0, 0, 0, 1) 0px, rgba(255, 0, 0, 0.2) 2px,
                rgba(0, 0, 0, 1) 4px, rgba(0, 255, 0, 0.2) 6px
            );
            pointer-events: none; z-index: 1; opacity: 0.7;
        }

        /* 核心大字容器 */
        .ghost-text-container {
            position: relative; z-index: 20; text-align: center;
            display: flex; flex-direction: column; gap: 1rem;
            mix-blend-mode: lighten; 
            pointer-events: none; 
        }
        .main-ghost-text {
            font-family: "SimSun", serif; font-size: 5rem; font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: -5px 0 rgba(255, 0, 0, 0.8), 5px 0 rgba(0, 255, 0, 0.8);
            line-height: 1.1;
            transition: all 0.5s ease;
        }

        /* 最终解锁状态样式 */
        .final-unlocked {
            pointer-events: auto !important; 
            cursor: pointer;
            color: #ff3333 !important; 
            text-shadow: 0 0 20px #ff3333, -5px 0 #fff, 5px 0 #fff !important;
            transform: scale(1.1);
            animation: pulse-red 1.5s infinite alternate;
            z-index: 100 !important;
            padding: 20px;
        }

        @keyframes pulse-red {
            from { text-shadow: 0 0 20px #ff3333; }
            to { text-shadow: 0 0 40px #ff3333, 0 0 10px #fff; transform: scale(1.15); }
        }

        .fragment {
            position: absolute; font-family: 'SimSun', serif; z-index: 10;
            pointer-events: none; color: rgba(255, 255, 255, 0.5);
            text-shadow: -2px 2px rgba(255, 0, 0, 0.5), 2px -2px rgba(0, 255, 0, 0.5);
            white-space: nowrap; user-select: none;
        }

        /* --- 特殊链接样式 --- */
        .special-link {
            position: absolute; font-family: 'SimSun', serif; z-index: 15;
            text-decoration: none; cursor: pointer; color: rgba(255, 255, 255, 0.95);
            font-weight: bold;
            text-shadow: -3px 0 rgba(255, 0, 0, 0.9), 3px 0 rgba(0, 255, 0, 0.9);
            transition: all 0.5s ease;
            white-space: nowrap;
        }
        
        .special-link:hover {
            transform: scale(1.2) !important; color: #fff; z-index: 25;
        }

        /* 未解锁的链接，直接隐藏 */
        .special-link.locked {
            display: none !important;
        }

        .special-link.visited {
            color: #555; text-shadow: none; text-decoration: line-through; opacity: 0.6;
        }

        /* ========================================================== */
        /* ★ 核心修改：移动端响应式适配 (Mobile Styles) ★ */
        /* ========================================================== */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                padding: 10px;
                position: relative; /* 手机上不固定，避免遮挡 */
                margin-bottom: 20px;
            }
            .nav-links span {
                display: block;
                margin: 5px 0;
                font-size: 1rem;
            }
            
            .container {
                margin-top: 20px;
                padding: 20px;
                width: 95%;
            }

            /* 卡片垂直排列 */
            .asset-card {
                flex-direction: column;
            }
            .asset-img-box {
                width: 100%;
                height: 300px; /* 图片高度自适应 */
                flex: none;
            }
            
            /* 鬼畜文字缩小，防止手机上爆屏 */
            .main-ghost-text { font-size: 2.5rem !important; }
            #finalTrigger { font-size: 3.5rem !important; }
            
            .modal-content {
                padding: 30px;
            }
            .modal-text {
                font-size: 1.5rem;
            }
            
            /* 页码位置 */
            .page-number { bottom: 100px; right: 20px; font-size: 12px; }
        }

        /* ========================================================== */
        /* ★ 核心修改：通用手机插件包 (黑客/终端风格) ★ */
        /* ========================================================== */
        /* 手机端工具栏样式 */
        .mobile-tools-hacker {
            position: fixed;
            bottom: 30px; left: 20px;
            z-index: 99999 !important;
            display: flex; flex-direction: column; gap: 15px;
        }
        .tool-btn-hacker {
            width: 50px; height: 50px;
            background-color: rgba(0, 0, 0, 0.9); /* 黑底 */
            border: 1px solid #00ff41; /* 绿边 */
            border-radius: 50%;
            color: #00ff41; /* 绿字 */
            display: flex; justify-content: center; align-items: center;
            font-size: 1.2rem; text-decoration: none;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
            cursor: pointer;
        }
        .tool-btn-hacker:active { transform: scale(0.95); background: #003300; }

        /* 笔记弹窗样式 (终端风格) */
        .note-modal-hacker {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.85);
            z-index: 100000 !important;
        }
        .note-box-hacker {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 85%; max-width: 400px;
            background-color: #000;
            border: 1px solid #00ff41;
            padding: 20px; border-radius: 4px;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
        }
        .note-header-hacker {
            display: flex; justify-content: space-between; margin-bottom: 15px;
            border-bottom: 1px dashed #00ff41; padding-bottom: 10px;
        }
        .note-title-hacker { color: #00ff41; font-family: 'Roboto Mono', monospace; font-weight: bold; }
        .note-area-hacker {
            width: 100%; height: 200px;
            background: #0a0a0a; border: 1px solid #00ff41; color: #00ff41;
            padding: 10px; font-family: 'Roboto Mono', monospace; font-size: 14px; resize: none;
            outline: none;
        }
        .note-area-hacker:focus { box-shadow: 0 0 5px #00ff41; }

    </style>
</head>
<body>

    <div class="overlay-bg"></div>
    <div class="page-number">23/39</div>

    <div class="mobile-tools-hacker">
        <a href="index.html" class="tool-btn-hacker">
            <i class="fas fa-home"></i>
        </a>
        
        <div class="tool-btn-hacker" onclick="window.history.back()">
            <i class="fas fa-arrow-left"></i>
        </div>

        <div class="tool-btn-hacker" onclick="toggleNoteModal(true)">
            <i class="fas fa-book-open"></i>
        </div>
    </div>

    <div class="note-modal-hacker" id="noteModalHacker" onclick="if(event.target === this) toggleNoteModal(false)">
        <div class="note-box-hacker">
            <div class="note-header-hacker">
                <span class="note-title-hacker">SYSTEM_LOG // NOTE</span>
                <span style="cursor: pointer; color: #ff3333; font-size: 1.5rem;" onclick="toggleNoteModal(false)">&times;</span>
            </div>
            <textarea class="note-area-hacker" id="universalNoteHacker" placeholder="Input data..."></textarea>
        </div>
    </div>

    <nav class="navbar">
        <div class="nav-links">
            <span>我们的驯化</span>
            <span>包装流程</span>
            <span>已完成品清单</span>
        </div>
    </nav>

    <div class="container">
        <h1>资产状态概览 (部分摘录)</h1>
        
        <div class="asset-card">
            <div class="asset-img-box"><img src="小雅1.jpg" alt="LHH-034-A1" class="asset-img"></div>
            <div class="asset-info">
                <div class="data-row"><span class="label">资产编号：</span><span class="value">LHH-034-A1</span></div>
                <div class="data-row"><span class="label">化名/曾用代号：</span><span class="value">"小雅"</span></div>
                <div class="data-row"><span class="label">当前信号位置：</span><span class="value">最后一次卫星信号，距菲律宾海岸线约12海里</span></div>
                <div class="data-row"><span class="label">预期交接点：</span><span class="value">"新家园7号"接收站</span></div>
                <div class="data-row"><span class="label">备注：</span><span class="value">该资产心理评估显示"高共情性"与"强服从性"，创伤背景使其对"庇护所"叙事接受度极高，运输过程未出现抵抗行为。</span></div>
            </div>
        </div>

        <div class="asset-card">
            <div class="asset-img-box"><img src="林小姐1.jpg" alt="LHH-021-B3" class="asset-img"></div>
            <div class="asset-info">
                <div class="data-row"><span class="label">资产编号：</span><span class="value">LHH-021-B3</span></div>
                <div class="data-row"><span class="label">化名/曾用代号：</span><span class="value">"林小姐"</span></div>
                <div class="data-row"><span class="label">安置地点：</span><span class="value">"正脉研修中心·西北分院"</span></div>
                <div class="data-row"><span class="label">当前角色/用途：</span><span class="value">"艺术疗愈"展示性样本及内部创意服务。</span></div>
                <div class="data-row"><span class="label">监控摘要：</span><span class="value">资产持续产出符合"疗愈与重生"主题的艺术品，作品用于组织公关宣传及赠予特定合作伙伴。近期生理监测显示有轻微抑郁复发迹象，已通过调整药物剂量控制。注意：需维持其创作能力与表面积极性之间的平衡。</span></div>
            </div>
        </div>

        <div class="asset-card">
            <div class="asset-img-box"><img src="芳芳1.jpg" alt="LHH-058-C2" class="asset-img"></div>
            <div class="asset-info">
                <div class="data-row"><span class="label">资产编号：</span><span class="value">LHH-058-C2</span></div>
                <div class="data-row"><span class="label">化名/曾用代号：</span><span class="value">"芳芳"（附带子资产：LHH-058-C2C，男童，8岁）</span></div>
                <div class="data-row"><span class="label">当前位置：</span><span class="value">拉斯维加斯</span></div>
                <div class="data-row"><span class="label">当前状态：</span><span class="value">跨国婚姻中的妻子与继母角色。该资产被评估为具备“传统家庭观念及“强烈母性保护欲”，符合“稳定家庭服务型”输送标准。</span></div>
            </div>
        </div>
    </div>

    <div id="finalModal" class="modal">
        <div class="modal-content">
            <p class="modal-text">你<span class="forever">永远</span>用不着担心这些。</p>
            <button class="close-btn" id="closeBtn">关闭</button>
        </div>
    </div>

    <div id="glitch-overlay">
        <div class="noise-bg"></div>
        <div class="ghost-text-container">
            <div class="main-ghost-text">拜托你</div>
            <div class="main-ghost-text" id="finalTrigger" style="font-size: 7rem; z-index: 2;">找到我</div>
            <div class="main-ghost-text">拜托你</div>
        </div>
    </div>

    <script>
        const modal = document.getElementById('finalModal');
        const closeBtn = document.getElementById('closeBtn');
        const glitchOverlay = document.getElementById('glitch-overlay');
        const body = document.body;
        
        // 游戏进度 Key
        const GAME_PROGRESS_KEY = 'qiyuan_puzzle_step'; 
        // 0 = 初始, 1 = 看过燕, 2 = 看过箐, 3 = 看过卿 (完成)

        let closeCount = 0;
        let isGlitchActive = false;

        // ★ 修复：立即执行检查，不再等待 load 事件，防止闪屏 ★
        (function checkProgressImmediately() {
            const currentStep = parseInt(localStorage.getItem(GAME_PROGRESS_KEY) || '0');
            
            // 如果进度大于0（说明玩家已经开始解谜并返回了），直接进入花屏模式
            if (currentStep > 0) {
                modal.style.display = 'none'; // 隐藏初始弹窗
                // 立即强制显示遮罩，避免等待
                glitchOverlay.style.display = 'flex';
                body.classList.add('glitch-active');
                triggerGlitchMode(); // 初始化花屏逻辑
            }
        })();

        // 1. 关闭初始弹窗
        function closeModal(e) {
            e.stopPropagation(); 
            closeCount++;
            if (closeCount >= 3) {
                triggerGlitchMode();
            } else {
                modal.style.display = 'none';
            }
        }

        // 2. 触发花屏 (修改版)
        function triggerGlitchMode() {
            isGlitchActive = true;
            modal.style.display = 'none';
            glitchOverlay.style.display = 'flex'; 
            body.classList.add('glitch-active');

            // 只有当是第一次进入（元素为空）才生成随机背景字
            if (glitchOverlay.querySelectorAll('.fragment').length === 0) {
                for(let i=0; i<150; i++) {
                    createRandomText();
                }
            }

            // 获取当前进度
            const currentStep = parseInt(localStorage.getItem(GAME_PROGRESS_KEY) || '0');

            // 检查是否全部完成，如果是，直接触发最终逻辑
            if (currentStep >= 3) {
                unlockFinalSecret();
            }

            // 定义顺序列表
            const specialItems = [
                { text: "燕", url: "diary.html" }, 
                { text: "箐", url: "diary2.html" }, 
                { text: "卿", url: "diary3.html" } 
            ];

            // 清除旧的链接防止重复叠加 (如果有)
            const oldLinks = document.querySelectorAll('.special-link');
            oldLinks.forEach(link => link.remove());

            specialItems.forEach((item, index) => {
                createSpecialLink(item, index, currentStep);
            });
        }

        function createRandomText() {
            const span = document.createElement('div');
            span.innerText = Math.random() > 0.5 ? "找到我" : "拜托你";
            span.className = 'fragment';
            span.style.left = (Math.random() * 100 - 10) + 'vw';
            span.style.top = (Math.random() * 100 - 10) + 'vh';
            const maxFont = window.innerWidth < 768 ? 2 : 4;
            span.style.fontSize = (Math.random() * maxFont + 0.8) + 'rem';
            span.style.opacity = Math.random() * 0.6 + 0.1;
            span.style.transform = `rotate(${Math.random() * 60 - 30}deg)`;
            glitchOverlay.appendChild(span);
        }

        // 生成链接 (根据进度判断显示状态)
        function createSpecialLink(item, index, currentStep) {
            const link = document.createElement('a');
            link.innerText = item.text;
            link.href = item.url;
            
            link.className = 'special-link';
            link.id = `locked-link-${index}`;

            // ★ 核心逻辑：状态判断 ★
            if (index < currentStep) {
                // 如果这个序号小于当前进度 -> 已经看过了 (变灰/划掉)
                link.classList.add('visited');
            } else if (index === currentStep) {
                // 如果这个序号等于当前进度 -> 正好是现在要看的 (正常显示)
            } else {
                // 如果这个序号大于当前进度 -> 还没轮到 (隐藏)
                link.classList.add('locked');
            }

            link.style.left = (Math.random() * 80 + 10) + 'vw';
            link.style.top = (Math.random() * 80 + 10) + 'vh';
            const linkSize = window.innerWidth < 768 ? (Math.random() * 2 + 2) : (Math.random() * 3 + 4);
            link.style.fontSize = linkSize + 'rem';
            link.style.transform = `rotate(${Math.random() * 40 - 20}deg)`;

            glitchOverlay.appendChild(link);
        }

        // 最终解锁逻辑 (已移除地址弹窗功能)
        function unlockFinalSecret() {
            const finalTrigger = document.getElementById('finalTrigger');
            finalTrigger.classList.add('final-unlocked');
            
            // 已删除点击后的地址弹窗事件
            finalTrigger.addEventListener('click', function(e) {
                e.stopPropagation();
                // 可以在这里添加其他结束效果，或者什么都不做
                console.log("End of line."); 
            });
        }

        closeBtn.addEventListener('click', closeModal);

        // 只有当不是花屏模式，且不是从子页面返回时才弹出
        document.addEventListener('click', function(event) {
            if (isGlitchActive) return; 
            if (modal.style.display !== 'flex' && localStorage.getItem(GAME_PROGRESS_KEY) === null) {
                modal.style.display = 'flex';
            }
        });
        
        document.querySelectorAll('.modal-content').forEach(c => {
            c.addEventListener('click', function(e){ e.stopPropagation(); });
        });

        // 笔记功能逻辑
        function toggleNoteModal(show) {
            const modal = document.getElementById('noteModalHacker');
            const textarea = document.getElementById('universalNoteHacker');
            
            if (show) {
                modal.style.display = 'block';
                if(textarea) textarea.value = localStorage.getItem('qiyuan_universal_note') || '';
            } else {
                modal.style.display = 'none';
            }
        }

        (function(){
            const textarea = document.getElementById('universalNoteHacker');
            if(textarea) {
                textarea.addEventListener('input', function() {
                    localStorage.setItem('qiyuan_universal_note', this.value);
                });
            }
        })();
    </script>
</body>
</html>